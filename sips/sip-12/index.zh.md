---
sip: 12
title: 状态计费
author: @suoyuan
type: Standards Track
category: Core
status: Draft
created: 2020-08-06
---
# 状态计费
## 背景
区块链协议设计中一个具挑战性的问题是如何对被纳入链中的交易的提交进行限制和定价，每一笔交易都会受利益驱动，但交易也会给整个网络带来社会成本，因为网络中的每个节点都必须处理每一笔交易，这就导致了一个典型的 "公共问题"。在这种情况下，经济理论一般要求对有关资源进行定价，并将价格设定为等于消耗每一种资源的行为给网络带来的社会成本。然而，由于所涉及的计算、带宽和存储资源的异质性，社会成本中有很大一部分是以集中化风险等无形的、难以估价的危害形式存在的，而且需要创建一个自动算法，在不需要人工干预的情况下，可以在未来广泛的场景下设定价格，这些都使得设定最优的限制非常困难。这就引出我们的状态计费问题，实际上是保存这些状态涉及的资源流转而产生的费用问题。

## 分析
有许多类型的经济机制可以用来解决这种类型的资源定价问题，要理解哪种机制是最优的，需要更深入地理解有关社会成本的性质和类型。
- 首先，可以按资源支出的基本类型进行分类。
  带宽成本：所有节点下载每个提交的交易，将其捆绑成一个区块，作为某个区块的一部分重播交易，并可能在一定时间内存储历史数据的成本。
  计算成本：每个节点为处理每笔交易而运行计算（如签名验证、余额递增、智能合约执行）的成本。
  状态存储成本：每一个节点为了能够处理进一步的交易而必须存储的交易对状态（如合约代码、账户余额）大小的影响的边际成本。
  需要注意的是，前两个成本是在打包交易节点所支付的成本，但第三个成本必须由所有节点永远支付，除非引入一个方案，使所有的状态条目都是暂时的，就是现在有人提出的无状态的思路。总之，前两种流量，后一种是存量。
- 下来我们重点关注状态存储成本。
  状态存储的关键问题在于清理存储的动力不足。
- 设计良好的状态存储机制必须能够实现以下目标:
  1. 必须限制全球状态的增长，以提供完全节点参与的可预测性。
  2. 随着全球状态的有限增长，扩大它的价格和减少它的回报应该由市场决定。特别是，最好是在状态存储大部分已满时增加状态存储的成本，而在状态大部分为空时降低状态存储的成本。
  3. 该系统必须能够不断增加拥有闲置资源用户的收入，以向矿工支付提供该资源的费用。这既可以达到平衡矿工经济的目的，又可以鼓励用户尽早清除不必要的状态。

就像比特币如何限制和强制带宽定价以及以太坊如何限制计算定价一样，要保持区块链网络长期分散和可持续发展，我们必须想出一种方法来限制全球价格并为之定价。这对于注重保存的资产存储网络尤其重要，在该网络中，网络的使用与大多数脱链交易无关，而与全球状态的持续占领有关。

## 实现
  StarCoin通过SCB实现状态存储的计费。

### 基础Token
StarCoin 的基础Token是SCB（StarCoin Bytes）。SCB以字节为单位表示基础的单元容量，是所有者能够占据StarCoin区块链全球状态的大小的描述方式。SCB的进制方式与计算机存储的单位进制一致，K，M，G等。例如，如果爱丽丝拥有1000个SCB字节，则她可以存储资源的最大上限就是1000字节，存储类型包括module、scripts或其他resouce。

### SCB兑换
StarCoin提供固定的兑换比例： 1 STC = 10M SCB

### SCB的使用
SCB在用户的正常状态流转的交易完成后，就会实时的增减掉，通过account show命令可以查询，跟blance同级展示。当用户的SCB余量不足（及小于等于0）时，当前执行的交易就会失败。
